#! /bin/sh
# Script to fix permissions of Drupal site root directory
# run this script in the Drupal root directory
# Generated by Chef for <%= node['fqdn']%>

set -e
set -x

chgrp <%= @group %> -R '<%= @project_path %>'
chmod -R g=rwx '<%= @project_path %>'
chmod -R g+s '<%= @project_path %>'

chown -R <%= @user %>:<%= @group %> '<%= @site_path %>'
find '<%= @site_path %>' -type f -exec chmod u=r,g=rw,o-rwx '{}' \;
find '<%= @site_path %>' -type d -exec chmod u=rx,g=rwx,o-rwx '{}' \;

<% @writable_dirs.each do |dir| %>
if test -d <%= "#{@site_path}/#{dir}" %>; then
  chmod -R u+w <%= "#{@site_path}/#{dir}" %>
fi
<% end %>
